<!DOCTYPE html>
<!--
  í† ì§€ì •ë³´ ì¡°íšŒ ì‹œìŠ¤í…œ
  Copyright (c) 2025 landinfo. All rights reserved.
  ë¬´ë‹¨ ë³µì œ, ë°°í¬, ìˆ˜ì •ì„ ê¸ˆí•©ë‹ˆë‹¤.
  Unauthorized copying, distribution, or modification of this software is prohibited.
-->
<html style="height:100%;margin:0;padding:0;">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<meta name="robots" content="noindex, noarchive, nosnippet"/>
<meta name="google-adsense-account" content="ca-pub-4187457564577316">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4187457564577316" crossorigin="anonymous"></script>
<title>í† ì§€ì •ë³´ ì¡°íšŒ ì‹œìŠ¤í…œ</title>
<script src="https://map.vworld.kr/js/vworldMapInit.js.do?version=2.0&apiKey=A12CEDAE-86F1-3453-BC92-3FD98BE14103"></script>
<script src="https://map.vworld.kr/js/webglMapInit.js.do?version=3.0&apiKey=A12CEDAE-86F1-3453-BC92-3FD98BE14103"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"/>
<script src="https://ecvam.neins.go.kr/apiConfirm.do?APIKEY=MUTW-PGHX-76CT-ENMD"></script>
<style>
*{box-sizing:border-box;}
html,body{height:100%;margin:0;padding:0;overflow:hidden;font-family:'Malgun Gothic','Apple SD Gothic Neo',sans-serif;font-size:13px;}
.wrap{display:flex;height:100vh;width:100vw;}

/* â”€â”€ ì§€ë„ ì˜ì—­ â”€â”€ */
.map-area{flex:1;position:relative;height:100%;}
#vmap,#ol3map{width:100%;height:100%;position:absolute;top:0;left:0;}
.map-ctrl{position:absolute;top:10px;left:10px;z-index:999;background:rgba(255,255,255,.92);border-radius:8px;padding:6px 10px;box-shadow:0 2px 8px rgba(0,0,0,.2);}
.map-ctrl select{border:none;background:transparent;font-weight:600;font-size:13px;cursor:pointer;outline:none;}

/* â”€â”€ ì‚¬ì´ë“œ íŒ¨ë„ â”€â”€ */
.side{width:360px;min-width:300px;display:flex;flex-direction:column;height:100%;border-left:2px solid #dde1f0;background:#f4f6fb;overflow:hidden;}

/* í—¤ë” */
.hd{background:linear-gradient(135deg,#3a7bd5,#00d2ff);color:#fff;padding:16px 18px;flex-shrink:0;}
.hd h1{margin:0;font-size:17px;font-weight:700;}
.hd p{margin:4px 0 0;font-size:11px;opacity:.85;}

/* ê²€ìƒ‰ */
.search-row{display:flex;gap:6px;padding:12px;background:#fff;border-bottom:1px solid #e0e4f0;flex-shrink:0;position:relative;}
.search-row input{flex:1;padding:8px 10px;border:1px solid #c5cde0;border-radius:6px;font-size:13px;outline:none;}
.search-row input:focus{border-color:#3a7bd5;}
.search-row button{padding:8px 14px;background:linear-gradient(135deg,#3a7bd5,#00d2ff);color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;white-space:nowrap;}

/* ë²„íŠ¼ ê·¸ë£¹ */
.btn-row{display:flex;gap:8px;padding:10px 12px;background:#fff;border-bottom:1px solid #e0e4f0;flex-shrink:0;}
.btn-row button{flex:1;padding:8px 4px;border:none;border-radius:6px;cursor:pointer;font-size:12px;font-weight:600;color:#fff;}
.btn-export{background:linear-gradient(135deg,#11998e,#38ef7d);}
.btn-table-win{background:linear-gradient(135deg,#4776E6,#8E54E9);}
.btn-clear{background:linear-gradient(135deg,#f7971e,#ffd200);color:#333!important;}

/* ì˜µì…˜ í…Œì´ë¸” */
.opt-table{width:100%;padding:10px 12px;background:#fff;border-bottom:1px solid #e0e4f0;flex-shrink:0;}
.opt-table table{width:100%;border-collapse:collapse;}
.opt-table th{text-align:left;padding:5px 6px;color:#555;font-weight:600;width:48%;}
.opt-table td{padding:5px 6px;}
.opt-table td span{font-weight:600;color:#3a7bd5;}

/* ì£¼ì œë„ íŒ¨ë„ */
.theme-panel{padding:10px 12px;background:#fff;border-bottom:1px solid #e0e4f0;flex-shrink:0;}
.theme-hd{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;}
.theme-hd-title{font-weight:700;color:#333;font-size:13px;}
.toggle-btn{padding:3px 10px;background:#e8edf5;border:1px solid #c0c8dc;border-radius:4px;cursor:pointer;font-size:11px;font-weight:600;}
#themeList{display:none;max-height:180px;overflow-y:auto;}
.theme-item{display:flex;align-items:center;gap:6px;padding:4px 2px;border-bottom:1px solid #f0f3fb;cursor:grab;user-select:none;}
.theme-item:hover{background:#f4f7ff;}
.theme-item label{flex:1;cursor:pointer;font-size:12px;}
.drag-handle{color:#aaa;font-size:14px;cursor:grab;}

/* ìƒíƒœ ë©”ì‹œì§€ */
.status-bar{margin:8px 12px;padding:8px 10px;background:#e8f4fd;border-left:3px solid #3a7bd5;border-radius:4px;font-size:12px;color:#1a5fa8;display:none;}
.status-bar.ok{background:#e6f9ef;border-left-color:#27ae60;color:#1a7a42;}
.status-bar.err{background:#fdecea;border-left-color:#e74c3c;color:#c0392b;}

/* ECVAM í™˜ê²½ì„±í‰ê°€ ë“±ê¸‰ ë°°ì§€ */
.ecvam-badge{display:inline-block;padding:1px 7px;border-radius:9px;font-size:11px;font-weight:700;color:#fff;}
.ecvam-gr1{background:#006633;}.ecvam-gr2{background:#339966;}
.ecvam-gr3{background:#BBAA00;color:#fff;}.ecvam-gr4{background:#CC6600;}
.ecvam-gr5{background:#CC3300;}
.ecvam-link{font-size:10px;color:#3a7bd5;text-decoration:underline;cursor:pointer;}
/* ECVAM ë²”ë¡€ */
.ecvam-legend{display:flex;gap:4px;flex-wrap:wrap;padding:2px 12px 6px;}

/* ì¹´ìš´íŠ¸ */
.cnt-bar{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;flex-shrink:0;}
.cnt-bar .ttl{font-weight:700;font-size:13px;color:#333;}
.cnt-badge{background:linear-gradient(135deg,#3a7bd5,#00d2ff);color:#fff;padding:3px 10px;border-radius:20px;font-size:12px;font-weight:700;}
/* ì •ë ¬ ë²„íŠ¼ */
.sort-btn{padding:2px 7px;border:1px solid #b0bcd8;border-radius:4px;background:#f0f4ff;color:#3a7bd5;font-size:10px;font-weight:700;cursor:pointer;white-space:nowrap;}
.sort-btn.active{background:#3a7bd5;color:#fff;border-color:#3a7bd5;}

/* í† ì§€ ëª©ë¡ */
.land-list{flex:1;overflow-y:auto;padding:0 12px 12px;}
.land-item{margin-bottom:10px;background:#fff;border:1px solid #dde3f5;border-radius:8px;box-shadow:0 1px 4px rgba(60,80,180,.07);transition:box-shadow .2s;}
.land-item:hover{box-shadow:0 4px 14px rgba(60,80,180,.15);}
.land-item-hd{display:flex;justify-content:space-between;align-items:center;padding:10px 12px 8px;border-bottom:2px solid #f0f3fb;gap:4px;}
.land-item-hd span{color:#3a7bd5;font-weight:700;font-size:13px;flex:1;margin-right:4px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.del-btn{padding:3px 9px;background:linear-gradient(135deg,#f093fb,#f5576c);color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:11px;font-weight:600;white-space:nowrap;}
.newwin-btn{padding:3px 8px;background:linear-gradient(135deg,#4776E6,#8E54E9);color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:11px;font-weight:600;white-space:nowrap;}
/* í† ì§€ ì¹´ë“œ - ì‹¬í”Œ key:value ê·¸ë¦¬ë“œ */
.land-kv{padding-bottom:4px;}
.land-kv-sec{padding:3px 12px;font-size:10px;font-weight:700;color:#3a7bd5;background:#f0f4ff;letter-spacing:.3px;}
.land-kv-row{display:flex;justify-content:space-between;align-items:baseline;padding:4px 12px;border-bottom:1px solid #f5f7ff;}
.land-kv-row:last-child{border-bottom:none;}
.land-kv-k{color:#777;font-weight:600;min-width:90px;flex-shrink:0;font-size:11px;}
.land-kv-v{color:#1a1a2e;font-weight:700;text-align:right;word-break:break-all;font-size:12px;}

/* ëª¨ë°”ì¼ í…Œì´ë¸” (ë°ìŠ¤í¬íƒ‘ì—ì„œ í•­ìƒ ìˆ¨ê¹€ - !importantë¡œ JS inline style ë°©ì§€) */
.mob-land-tbl-wrap{display:none!important;}

/* ì£¼ì†Œ ê²€ìƒ‰ ê²°ê³¼ ë“œë¡­ë‹¤ìš´ */
.addr-results{position:absolute;left:0;right:0;top:100%;z-index:9999;background:#fff;border:1px solid #c5cde0;border-top:none;border-radius:0 0 8px 8px;box-shadow:0 4px 16px rgba(60,80,180,.15);max-height:220px;overflow-y:auto;}
.addr-result-item{padding:9px 12px;font-size:12px;color:#333;cursor:pointer;border-bottom:1px solid #f0f3fb;display:flex;flex-direction:column;gap:2px;}
.addr-result-item:last-child{border-bottom:none;}
.addr-result-item:hover{background:#f0f4ff;}
.addr-result-name{font-weight:600;color:#1a3580;}
.addr-result-addr{font-size:11px;color:#888;}


/* â”€â”€ ë„ì›€ë§ ë²„íŠ¼ â”€â”€ */
.help-btn{position:absolute;top:14px;right:14px;width:28px;height:28px;background:rgba(255,255,255,.25);border:2px solid rgba(255,255,255,.7);border-radius:50%;color:#fff;font-size:14px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;line-height:1;transition:background .2s;}
.help-btn:hover{background:rgba(255,255,255,.45);}

/* â”€â”€ ë„ì›€ë§ ëª¨ë‹¬ ì˜¤ë²„ë ˆì´ â”€â”€ */
#helpModal{display:none;position:fixed;inset:0;z-index:9999;background:rgba(10,20,50,.55);backdrop-filter:blur(3px);}
#helpModal.open{display:flex;align-items:center;justify-content:center;}
.help-modal-box{background:#fff;border-radius:14px;width:min(680px,96vw);max-height:90vh;display:flex;flex-direction:column;box-shadow:0 8px 40px rgba(0,0,0,.3);overflow:hidden;}
.help-modal-hd{background:linear-gradient(135deg,#3a7bd5,#00d2ff);color:#fff;padding:18px 22px;display:flex;align-items:center;justify-content:space-between;flex-shrink:0;}
.help-modal-hd h2{margin:0;font-size:17px;font-weight:700;}
.help-modal-hd p{margin:4px 0 0;font-size:11px;opacity:.85;}
.help-modal-close{background:rgba(255,255,255,.2);border:none;color:#fff;font-size:18px;cursor:pointer;border-radius:50%;width:30px;height:30px;display:flex;align-items:center;justify-content:center;font-weight:700;flex-shrink:0;}
.help-modal-close:hover{background:rgba(255,255,255,.4);}
.help-modal-body{overflow-y:auto;padding:20px 22px 24px;flex:1;}
.help-modal-body::-webkit-scrollbar{width:5px;}
.help-modal-body::-webkit-scrollbar-thumb{background:#b0bcd8;border-radius:3px;}

/* ì„¹ì…˜ */
.hm-sec{margin-bottom:22px;}
.hm-sec-title{font-size:14px;font-weight:700;color:#2255a4;border-left:4px solid #3a7bd5;padding-left:10px;margin-bottom:10px;}
.hm-row{display:flex;gap:8px;margin-bottom:7px;align-items:flex-start;}
.hm-icon{font-size:18px;flex-shrink:0;width:26px;text-align:center;margin-top:1px;}
.hm-text{font-size:12px;color:#333;line-height:1.6;}
.hm-text strong{color:#1a3a80;font-weight:700;}
.hm-badge{display:inline-block;padding:1px 7px;border-radius:10px;font-size:10px;font-weight:700;color:#fff;background:#3a7bd5;margin:0 2px;}
.hm-badge.green{background:#27ae60;}.hm-badge.orange{background:#e67e22;}.hm-badge.purple{background:#8e44ad;}.hm-badge.red{background:#e74c3c;}
.hm-tip{background:#f0f6ff;border:1px solid #c8daff;border-radius:6px;padding:8px 12px;font-size:11px;color:#2255a4;margin-top:6px;line-height:1.7;}
.hm-divider{border:none;border-top:1px solid #eee;margin:18px 0;}
.hm-table{width:100%;border-collapse:collapse;font-size:11px;margin-top:6px;}
.hm-table th{background:#f0f4ff;color:#2255a4;font-weight:700;padding:6px 10px;text-align:left;border:1px solid #dde3f5;}
.hm-table td{padding:6px 10px;border:1px solid #eef1fb;color:#333;line-height:1.5;}
.hm-table tr:nth-child(even) td{background:#fafbff;}

/* ëª¨ë°”ì¼ ë„ì›€ë§ ëª¨ë‹¬ */
@media(max-width:768px){
  .help-modal-box{width:100%;max-height:100vh;border-radius:16px 16px 0 0;position:fixed;bottom:0;left:0;right:0;}
  #helpModal.open{align-items:flex-end;}
  .help-modal-body{padding:14px 16px 20px;}
  .help-modal-hd{padding:14px 16px;}
}

/* ìŠ¤í¬ë¡¤ë°” */
.land-list::-webkit-scrollbar{width:6px;}
.land-list::-webkit-scrollbar-track{background:#f0f3fb;}
.land-list::-webkit-scrollbar-thumb{background:#b0bcd8;border-radius:3px;}

/* ë©´ì  í•©ê³„ ë°” */
.area-sum-bar{display:flex;justify-content:space-between;align-items:center;padding:7px 12px;background:linear-gradient(135deg,#e8f4fd,#d4eaf8);border-top:1px solid #b8d6ee;border-bottom:1px solid #b8d6ee;flex-shrink:0;}
.area-sum-label{font-size:12px;font-weight:600;color:#1a5fa8;}
.area-sum-val{font-size:14px;font-weight:700;color:#1a5fa8;letter-spacing:-.3px;}

/* footer */
.footer{padding:8px 12px;font-size:10px;color:#aaa;border-top:1px solid #e0e4f0;flex-shrink:0;}

/* ì§€ë„ ë§ˆìš°ìŠ¤ ì˜¤ë²„ íˆ´íŒ */
#mapTooltip{position:absolute;z-index:1000;background:rgba(15,20,40,0.82);color:#fff;padding:4px 10px;border-radius:5px;font-size:11px;font-weight:600;pointer-events:none;white-space:nowrap;box-shadow:0 2px 8px rgba(0,0,0,.3);display:none;max-width:260px;letter-spacing:.2px;}

/* ì§€ì ë„ ì¤Œ ê²½ê³  ë°°ë„ˆ */
#zoomWarn{position:absolute;bottom:18px;left:50%;transform:translateX(-50%);z-index:998;background:rgba(211,84,0,0.91);color:#fff;padding:7px 20px;border-radius:20px;font-size:12px;font-weight:700;white-space:nowrap;box-shadow:0 2px 10px rgba(0,0,0,.28);display:none;pointer-events:none;letter-spacing:.3px;}
@media(max-width:768px){#zoomWarn{bottom:8px;font-size:11px;padding:6px 14px;}}

/* ë¹ˆ ìƒíƒœ */
.empty-state{text-align:center;padding:40px 20px;color:#aab;}
.empty-state .ico{font-size:36px;margin-bottom:10px;}

/* â”€â”€ ëª¨ë°”ì¼ bottom sheet â”€â”€ */
.sheet-pull{display:none;} /* ë°ìŠ¤í¬íƒ‘ì—ì„œ ìˆ¨ê¹€ */

@media(max-width:768px){
  /* ë ˆì´ì•„ì›ƒ ì¬ì„¤ì • */
  .wrap{display:block;position:relative;}

  /* ì§€ë„: ìƒë‹¨ 55vh ê³ ì • (íŒ¨ë„ê³¼ ê²¹ì¹˜ì§€ ì•Šê²Œ) */
  .map-area{
    position:fixed;
    top:0;left:0;right:0;
    height:55vh;
    z-index:1;
  }

  /* ì‚¬ì´ë“œ: ì§€ë„ ë°”ë¡œ ì•„ë˜ (55vh~100vh) */
  .side{
    position:fixed;
    top:55vh;
    bottom:0;left:0;right:0;
    width:100%;
    height:45vh;
    min-width:unset;
    z-index:100;
    border-left:none;
    border-radius:16px 16px 0 0;
    box-shadow:0 -4px 24px rgba(0,0,0,.25);
    background:#f4f6fb;
    overflow:hidden;
    transition:transform .3s cubic-bezier(.25,.8,.25,1);
  }
  /* íŒ¨ë„ ìˆ¨ê¸°ê¸° (í•¸ë“¤ë§Œ ë…¸ì¶œ - ì„ íƒì ) */
  .side.sheet-collapsed{
    transform:translateY(calc(100% - 44px));
  }

  /* í•¸ë“¤ ë°” */
  .sheet-pull{
    display:flex;
    align-items:center;
    gap:8px;
    padding:8px 14px;
    background:#fff;
    border-bottom:1px solid #eee;
    cursor:pointer;
    flex-shrink:0;
    border-radius:16px 16px 0 0;
    order:1;
  }
  .sheet-pull-bar{
    flex-shrink:0;width:36px;height:4px;
    background:#ddd;border-radius:2px;
  }
  .sheet-pull-label{
    flex:1;font-size:12px;color:#555;
    white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
  }
  .sheet-pull-toggle{font-size:15px;color:#3a7bd5;font-weight:700;}

  /* í—¤ë”: íŒ¨ë„ ê³µê°„ ì ˆì•½ì„ ìœ„í•´ ìˆ¨ê¹€ (sheet-pull ë ˆì´ë¸”ë¡œ ëŒ€ì²´) */
  .hd{display:none!important;}

  /* ì˜µì…˜/í‘¸í„° ìˆ¨ê¹€ (ì£¼ì œë„ëŠ” í‘œì‹œ) */
  .opt-table,.footer{display:none!important;}

  /* ì£¼ì œë„ íŒ¨ë„: ëª¨ë°”ì¼ ì»´íŒ©íŠ¸ */
  .theme-panel{padding:3px 8px;border-bottom:1px solid #e0e4f0;order:10;}
  .theme-hd-title{font-size:11px;}
  .toggle-btn{padding:2px 7px;font-size:10px;}
  #themeList{max-height:90px;}
  #ecvamThemeList{max-height:90px;}
  .theme-item{padding:2px 2px;}
  .theme-item label{font-size:11px;}
  .ecvam-legend{padding:2px 8px 4px;}

  /* ê²€ìƒ‰ */
  .search-row{padding:5px 8px;gap:4px;order:2;}
  .search-row input{padding:5px 8px;font-size:12px;}
  .search-row button{padding:5px 8px;font-size:12px;}

  /* ë²„íŠ¼ */
  .btn-row{padding:4px 8px;gap:4px;order:8;}
  .btn-row button{padding:5px 2px;font-size:10px;}

  /* ìƒíƒœ ë©”ì‹œì§€ */
  .status-bar{order:3;}

  /* ì¹´ìš´íŠ¸/ë©´ì  */
  .cnt-bar{padding:4px 10px;order:5;}
  .cnt-bar .ttl{font-size:11px;}
  .area-sum-bar{padding:4px 10px;order:6;}
  .area-sum-label{font-size:11px;}
  .area-sum-val{font-size:12px;}

  /* í† ì§€ ëª©ë¡: ë‚¨ì€ ê³µê°„ */
  .land-list{
    padding:0 8px 8px;
    -webkit-overflow-scrolling:touch;
    overscroll-behavior:contain;
    order:4;
    height: auto;
    overflow: visible;
  }

  /* ì‚¬ì´ë“œ íŒ¨ë„ ë‚´ë¶€ ìŠ¤í¬ë¡¤ í—ˆìš© */
  .side{
    overflow-y: auto;
    display: flex;
    flex-direction: column;
  }

  /* â”€â”€ ëª¨ë°”ì¼: ì¹´ë“œ ìˆ¨ê¸°ê³  í…Œì´ë¸”ë§Œ í‘œì‹œ â”€â”€ */
  .land-item{display:none!important;}
  .land-item-hd{display:none!important;}
  /* ëª¨ë°”ì¼ í…Œì´ë¸” (ë°ì´í„° ìˆì„ ë•Œë§Œ í‘œì‹œ) */
  .mob-land-tbl-wrap.active{display:block!important;position:relative;overflow-x:auto;margin:8px 0;border-radius:8px;background:#fff;box-shadow:0 1px 6px rgba(0,0,0,.1);border:1px solid #dde3f5;}
  /* ì˜¤ë¥¸ìª½ ìŠ¤í¬ë¡¤ íŒíŠ¸ ê·¸ë¼ë°ì´ì…˜ */
  .mob-land-tbl-wrap::after{content:'';pointer-events:none;position:absolute;top:0;right:0;bottom:0;width:36px;background:linear-gradient(to right,rgba(255,255,255,0),rgba(255,255,255,.95));border-radius:0 8px 8px 0;z-index:3;transition:opacity .3s;}
  .mob-land-tbl-wrap.scrolled::after{opacity:0;}
  /* ìŠ¤í¬ë¡¤ íŒíŠ¸ í™”ì‚´í‘œ ë°°ì§€ */
  .mob-scroll-hint{position:sticky;right:4px;display:inline-block;background:#3a7bd5;color:#fff;font-size:10px;padding:2px 5px;border-radius:10px;margin:4px 4px 4px 0;float:right;opacity:.85;}
  .mob-land-tbl{width:100%;border-collapse:collapse;white-space:nowrap;}
  .mob-land-tbl thead th{background:#3a7bd5;color:#fff;padding:7px 6px;text-align:center;font-size:10px;font-weight:700;position:sticky;top:0;z-index:2;}
  .mob-land-tbl tbody td{padding:6px 5px;border-bottom:1px solid #eef1fb;text-align:center;color:#222;font-size:11px;}
  .mob-land-tbl tbody tr{cursor:pointer;}
  .mob-land-tbl tbody tr:hover td{background:#deeaff!important;}
  .mob-land-tbl tbody tr:nth-child(even) td{background:#f7f9ff;}
  .mob-land-tbl tbody tr:last-child td{border-bottom:none;}
  .mob-del-btn{padding:2px 6px;background:linear-gradient(135deg,#f093fb,#f5576c);color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:10px;font-weight:600;}
}
</style>
</head>
<body>
<div class="wrap">

  <!-- ì§€ë„ ì˜ì—­ -->
  <div class="map-area">
    <div id="vmap" style="display:none;"></div>
    <div id="ol3map"></div>
    <div id="mapTooltip"></div>
    <div id="zoomWarn">ğŸ” í™•ëŒ€í•´ì•¼ ì§€ì ì„ ì´ ë³´ì…ë‹ˆë‹¤</div>
    <div class="map-ctrl">
      <select id="mapTypeSel" onchange="changeMapType()">
        <option value="2d" selected>ğŸ—º 2D ì¼ë°˜ì§€ë„</option>
        <option value="3d">ğŸŒ 3D ì§€ë„</option>
      </select>
    </div>
  </div>

  <!-- ì‚¬ì´ë“œ íŒ¨ë„ -->
  <div class="side" id="sidePanel">

    <!-- ëª¨ë°”ì¼ bottom sheet í•¸ë“¤ -->
    <div class="sheet-pull" id="sheetPull" onclick="toggleMobileSheet()">
      <div class="sheet-pull-bar"></div>
      <span class="sheet-pull-label" id="sheetPullLabel">í† ì§€ì •ë³´ë¥¼ í´ë¦­í•˜ì—¬ ì¡°íšŒí•˜ì„¸ìš”</span>
      <span class="sheet-pull-toggle" id="sheetPullToggle">â–¼</span>
    </div>

    <!-- í—¤ë” -->
    <div class="hd" style="position:relative;">
      <h1>ğŸ› í† ì§€ì •ë³´ ì¡°íšŒ ì‹œìŠ¤í…œ</h1>
      <p>VWorld API ê¸°ë°˜ ì§€ì ì •ë³´ Â· ìš©ë„ì§€ì—­ Â· ì§€êµ¬ë‹¨ìœ„ Â· ê·œì œí˜„í™© ì¡°íšŒ</p>
      <button class="help-btn" onclick="openHelp()" title="ì‚¬ìš©ì„¤ëª…ì„œ">?</button>
    </div>

    <!-- ì£¼ì†Œ ê²€ìƒ‰ -->
    <div class="search-row">
      <input id="addrInput" type="text" placeholder="ì£¼ì†Œ ì…ë ¥ (ì˜ˆ: íŒêµë¡œ 242, ì„œìš¸ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™ 837)"/>
      <button onclick="searchAddress()">ğŸ” ê²€ìƒ‰</button>
    </div>

    <!-- ë‚´ë³´ë‚´ê¸°/ì§€ìš°ê¸° -->
    <div class="btn-row">
      <button class="btn-export" onclick="exportToCSV()">ğŸ’¾ í† ì§€ì¡°ì„œ ë‚´ë³´ë‚´ê¸°</button>
      <button class="btn-table-win" onclick="openTableWindow()">ğŸ“‹ í† ì§€ëª©ë¡ë³´ê¸°</button>
      <button class="btn-clear" onclick="clearLandInfo()">ğŸ—‘ ì „ì²´ ì‚­ì œ</button>
    </div>

    <!-- ì˜µì…˜ -->
    <div class="opt-table">
      <table>
        <tr>
          <th>ì§€ë„ íƒ€ì…</th>
          <td><span id="currentMapType">2D ì¼ë°˜ì§€ë„</span></td>
        </tr>
        <tr id="bldRow" style="display:none;">
          <th>ê±´ë¬¼ ë ˆì´ì–´</th>
          <td><input id="bldChk" type="checkbox" checked onchange="checkLayer(this,'facility_build')"> í‘œì‹œ</td>
        </tr>
        <tr>
          <th>í† ì§€ì •ë³´ ì¡°íšŒ</th>
          <td><input id="landChk" type="checkbox" onchange="toggleLandParcel(this.checked)"> í™œì„±í™”</td>
        </tr>
      </table>
    </div>

    <!-- êµ­í† ê³„íš ì£¼ì œë„ -->
    <div class="theme-panel">
      <div class="theme-hd">
        <span class="theme-hd-title">ğŸ“‹ êµ­í† ê³„íš ì£¼ì œë„</span>
        <button class="toggle-btn" onclick="toggleThemePanel()">í¼ì¹˜ê¸°</button>
      </div>
      <div id="themeList"></div>
    </div>

    <!-- ECVAM í™˜ê²½ì„±í‰ê°€ ì£¼ì œë„ -->
    <div class="theme-panel" id="ecvamPanel">
      <div class="theme-hd">
        <span class="theme-hd-title">ğŸŒ¿ êµ­í† í™˜ê²½ì„±í‰ê°€ ì£¼ì œë„</span>
        <button class="toggle-btn" id="ecvamToggleBtn" onclick="toggleEcvamPanel()">í¼ì¹˜ê¸°</button>
      </div>
      <div id="ecvamThemeList" style="display:none;">
        <!-- ë“±ê¸‰ ë²”ë¡€ -->
        <div class="ecvam-legend">
          <span class="ecvam-badge ecvam-gr1">1ë“±ê¸‰</span>
          <span class="ecvam-badge ecvam-gr2">2ë“±ê¸‰</span>
          <span class="ecvam-badge ecvam-gr3">3ë“±ê¸‰</span>
          <span class="ecvam-badge ecvam-gr4">4ë“±ê¸‰</span>
          <span class="ecvam-badge ecvam-gr5">5ë“±ê¸‰</span>
          <span style="font-size:9px;color:#999;align-self:center;">(1=ë³´ì „â†‘)</span>
        </div>
      </div>
    </div>

    <!-- ìƒíƒœ ë©”ì‹œì§€ -->
    <div class="status-bar" id="statusBar"></div>

    <!-- ì¹´ìš´íŠ¸ + ë©´ì  í•©ê³„ -->
    <div class="cnt-bar">
      <span class="ttl">ğŸ“‚ ìˆ˜ì§‘ëœ í† ì§€ ì •ë³´</span>
      <div style="display:flex;align-items:center;gap:4px;">
        <button class="sort-btn active" id="sortNewest" onclick="setSortMode('newest')">ìµœì‹ ìˆœ</button>
        <button class="sort-btn" id="sortJibunAsc" onclick="setSortMode('jibun_asc')">ì§€ë²ˆâ–²</button>
        <button class="sort-btn" id="sortJibunDesc" onclick="setSortMode('jibun_desc')">ì§€ë²ˆâ–¼</button>
        <span class="cnt-badge" id="landCnt">ì´ 0ê±´</span>
      </div>
    </div>
    <div class="area-sum-bar" id="areaSumBar" style="display:none; flex-direction:column; gap:4px; align-items:stretch;">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <span class="area-sum-label">ğŸ“ <span id="areaCnt">0</span>í•„ì§€ ë©´ì  í•©ê³„</span>
        <span class="area-sum-val" id="areaSumVal">0 ã¡</span>
      </div>
      <div id="jigaSumRow" style="display:flex; justify-content:space-between; align-items:center; border-top:1px dashed rgba(26,95,168,0.2); padding-top:4px; margin-top:2px;">
        <span class="area-sum-label">ğŸ’° ê³µì‹œì§€ê°€ ì´ì•¡
          <select id="jigaUnitSel" onchange="changeJigaUnit(this.value)" style="margin-left:5px;border:1px solid #b8d6ee;border-radius:4px;background:#eaf3fb;color:#1a5fa8;font-size:10px;font-weight:700;padding:1px 3px;cursor:pointer;outline:none;">
            <option value="ì›">ì›</option>
            <option value="ì²œì›">ì²œì›</option>
            <option value="ë°±ë§Œì›">ë°±ë§Œì›</option>
            <option value="ì–µì›">ì–µì›</option>
          </select>
        </span>
        <span class="area-sum-val" id="jigaSumVal" style="color:#e67e22;">0 ì›</span>
      </div>
    </div>

    <!-- í† ì§€ ëª©ë¡ -->
    <div class="land-list" id="landList">
      <!-- ëª¨ë°”ì¼ í…Œì´ë¸” (mobile only - .active í´ë˜ìŠ¤ë¡œ ì œì–´) -->
      <div id="mobLandTableWrap" class="mob-land-tbl-wrap">
        <div style="padding:3px 8px 2px;font-size:10px;color:#3a7bd5;font-weight:600;display:flex;align-items:center;gap:4px;">
          <span>ğŸ“‹ í† ì§€ ëª©ë¡</span>
          <span style="margin-left:auto;font-size:10px;color:#888;">â† ì¢Œìš° ìŠ¤í¬ë¡¤ë¡œ ë” ë³´ê¸° â†’</span>
        </div>
        <table class="mob-land-tbl">
          <thead>
            <tr>
              <th>ìˆœë²ˆ</th>
              <th>í–‰ì •ë™/ì§€ë²ˆ</th>
              <th>ì§€ëª©</th>
              <th>ë©´ì (ã¡)</th>
              <th>ìš©ë„ì§€ì—­</th>
              <th>ê¸°íƒ€ê·œì œ</th>
              <th>ì§€êµ¬ë‹¨ìœ„ê³„íšêµ¬ì—­</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="mobLandTbody"></tbody>
        </table>
      </div>
      <div class="empty-state">
        <div class="ico">ğŸ“</div>
        <p>ì§€ë„ì—ì„œ í† ì§€ë¥¼ í´ë¦­í•˜ë©´<br>ìƒì„¸ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤</p>
      </div>
    </div>

    <div class="footer">Â© 2025 í† ì§€ì •ë³´ì¡°íšŒì‹œìŠ¤í…œ Â· Powered by VWorld API</div>
  </div>
</div>

<!-- ====================================================
     ë„ì›€ë§ ëª¨ë‹¬
===================================================== -->
<div id="helpModal" onclick="closeHelpOutside(event)">
  <div class="help-modal-box">
    <div class="help-modal-hd">
      <div>
        <h2>ğŸ“– í† ì§€ì •ë³´ ì¡°íšŒ ì‹œìŠ¤í…œ ì‚¬ìš©ì„¤ëª…ì„œ</h2>
        <p>VWorld API ê¸°ë°˜ ì§€ì ì •ë³´ Â· ìš©ë„ì§€ì—­ Â· í™˜ê²½ì„±í‰ê°€ ì¡°íšŒ ê°€ì´ë“œ</p>
      </div>
      <button class="help-modal-close" onclick="closeHelp()">âœ•</button>
    </div>
    <div class="help-modal-body">

      <!-- 1. ì‹œì‘í•˜ê¸° -->
      <div class="hm-sec">
        <div class="hm-sec-title">1. ì‹œì‘í•˜ê¸°</div>
        <div class="hm-row">
          <div class="hm-icon">ğŸ—º</div>
          <div class="hm-text">ì‚¬ì´íŠ¸ì— ì ‘ì†í•˜ë©´ <strong>2D ì§€ë„</strong>ì™€ í•¨ê»˜ <strong>ì§€ì ë„ ë ˆì´ì–´</strong>ê°€ ìë™ìœ¼ë¡œ í™œì„±í™”ë©ë‹ˆë‹¤. ì§€ë„ë¥¼ ì¶©ë¶„íˆ í™•ëŒ€í•˜ë©´ ì§€ì ì„ (í•„ì§€ ê²½ê³„)ì´ í‘œì‹œë©ë‹ˆë‹¤.</div>
        </div>
        <div class="hm-row">
          <div class="hm-icon">ğŸ”</div>
          <div class="hm-text">ìš°ì¸¡ íŒ¨ë„ ìƒë‹¨ì˜ <strong>ì£¼ì†Œ ê²€ìƒ‰ì°½</strong>ì— ì£¼ì†Œë¥¼ ì…ë ¥í•˜ê³  ê²€ìƒ‰í•˜ë©´ í•´ë‹¹ ìœ„ì¹˜ë¡œ ì´ë™í•©ë‹ˆë‹¤.<br>ì˜ˆ) <em>íŒêµë¡œ 242</em> &nbsp;/&nbsp; <em>ì„œìš¸ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™ 837</em></div>
        </div>
        <div class="hm-tip">ğŸ’¡ ì§€ì ì„ ì´ ë³´ì´ì§€ ì•Šìœ¼ë©´ ì§€ë„ë¥¼ ë” í™•ëŒ€í•´ ì£¼ì„¸ìš”. í™”ë©´ í•˜ë‹¨ì— <strong>"í™•ëŒ€í•´ì•¼ ì§€ì ì„ ì´ ë³´ì…ë‹ˆë‹¤"</strong> ì•ˆë‚´ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</div>
      </div>

      <hr class="hm-divider"/>

      <!-- 2. ì§€ë„ ì¡°ì‘ -->
      <div class="hm-sec">
        <div class="hm-sec-title">2. ì§€ë„ ì¡°ì‘</div>
        <table class="hm-table">
          <tr><th>ë™ì‘</th><th>PC</th><th>ëª¨ë°”ì¼</th></tr>
          <tr><td>ì´ë™</td><td>ë§ˆìš°ìŠ¤ ë“œë˜ê·¸</td><td>ì†ê°€ë½ ë“œë˜ê·¸</td></tr>
          <tr><td>í™•ëŒ€/ì¶•ì†Œ</td><td>ë§ˆìš°ìŠ¤ íœ  ìŠ¤í¬ë¡¤</td><td>ë‘ ì†ê°€ë½ í•€ì¹˜</td></tr>
          <tr><td>í† ì§€ ì •ë³´ ì¡°íšŒ</td><td>ì§€ë„ ìœ„ í´ë¦­</td><td>ì§€ë„ ìœ„ íƒ­</td></tr>
        </table>
        <div class="hm-row" style="margin-top:10px;">
          <div class="hm-icon">ğŸŒ</div>
          <div class="hm-text">ì§€ë„ ì¢Œì¸¡ ìƒë‹¨ ë“œë¡­ë‹¤ìš´ì—ì„œ <strong>2D ì¼ë°˜ì§€ë„</strong>ì™€ <strong>3D ì§€ë„</strong>ë¥¼ ì „í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
        </div>
      </div>

      <hr class="hm-divider"/>

      <!-- 3. í† ì§€ ì •ë³´ ì¡°íšŒ -->
      <div class="hm-sec">
        <div class="hm-sec-title">3. í† ì§€ ì •ë³´ ì¡°íšŒ</div>
        <div class="hm-row">
          <div class="hm-icon">ğŸ‘†</div>
          <div class="hm-text"><strong>ì§€ë„ì—ì„œ ì›í•˜ëŠ” í•„ì§€ë¥¼ í´ë¦­</strong>í•˜ë©´ í•´ë‹¹ í† ì§€ì˜ ìƒì„¸ ì •ë³´ê°€ ìš°ì¸¡ íŒ¨ë„ì— ì¹´ë“œ í˜•íƒœë¡œ ì¶”ê°€ë©ë‹ˆë‹¤.</div>
        </div>
        <div class="hm-row">
          <div class="hm-icon">ğŸ“‹</div>
          <div class="hm-text">ìˆ˜ì§‘ëœ ê° ì¹´ë“œì—ì„œ í™•ì¸í•  ìˆ˜ ìˆëŠ” ì •ë³´:</div>
        </div>
        <table class="hm-table">
          <tr><th>í•­ëª©</th><th>ì„¤ëª…</th></tr>
          <tr><td>ì†Œì¬ì§€ / ì§€ë²ˆ</td><td>í–‰ì •ë™ëª…ê³¼ ì§€ë²ˆ ì£¼ì†Œ</td></tr>
          <tr><td>ì§€ëª©</td><td>í† ì§€ì˜ ì´ìš© ëª©ì  ë¶„ë¥˜ (ì „, ë‹µ, ëŒ€, ì„ì•¼ ë“±)</td></tr>
          <tr><td>ë©´ì </td><td>í•„ì§€ ë©´ì  (ã¡)</td></tr>
          <tr><td>ê³µì‹œì§€ê°€</td><td>ë‹¨ìœ„ë©´ì (ã¡)ë‹¹ ê³µì‹œì§€ê°€ (ì›)</td></tr>
          <tr><td>ìš©ë„ì§€ì—­</td><td>êµ­í† ê³„íšë²•ìƒ ìš©ë„ì§€ì—­</td></tr>
          <tr><td>ì§€êµ¬ë‹¨ìœ„ê³„íšêµ¬ì—­</td><td>ì§€êµ¬ë‹¨ìœ„ê³„íš êµ¬ì—­ ì—¬ë¶€ ë° ëª…ì¹­</td></tr>
          <tr><td>ì†Œìœ êµ¬ë¶„</td><td>êµ­ìœ ì§€ / ê³µìœ ì§€ / ì‚¬ìœ ì§€ ë“±</td></tr>
        </table>
        <div class="hm-row" style="margin-top:10px;">
          <div class="hm-icon">ğŸ”´</div>
          <div class="hm-text">í´ë¦­í•œ í•„ì§€ëŠ” ì§€ë„ ìœ„ì— <strong>ë¹¨ê°„ìƒ‰ í•˜ì´ë¼ì´íŠ¸</strong>ë¡œ í‘œì‹œë©ë‹ˆë‹¤.</div>
        </div>
        <div class="hm-row">
          <div class="hm-icon">ğŸ—‘</div>
          <div class="hm-text">ì¹´ë“œ ìš°ì¸¡ ìƒë‹¨ì˜ <strong>ì‚­ì œ ë²„íŠ¼</strong>ìœ¼ë¡œ ê°œë³„ í•„ì§€ë¥¼ ëª©ë¡ì—ì„œ ì œê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
        </div>
      </div>

      <hr class="hm-divider"/>

      <!-- 4. ì£¼ì œë„ -->
      <div class="hm-sec">
        <div class="hm-sec-title">4. ì£¼ì œë„ (ë ˆì´ì–´) í™œìš©</div>
        <div class="hm-row">
          <div class="hm-icon">ğŸ“‹</div>
          <div class="hm-text"><strong>êµ­í† ê³„íš ì£¼ì œë„</strong> íŒ¨ë„ì„ í¼ì¹˜ë©´ ì•„ë˜ ë ˆì´ì–´ë¥¼ ì§€ë„ì— ê²¹ì³ í‘œì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
        </div>
        <table class="hm-table">
          <tr><th>ë ˆì´ì–´</th><th>ì„¤ëª…</th></tr>
          <tr><td>ì—°ì†ì§€ì ë„</td><td>í•„ì§€ ê²½ê³„ë¥¼ ìƒ‰ìƒë³„ë¡œ êµ¬ë¶„í•œ ì§€ì  ë ˆì´ì–´</td></tr>
          <tr><td>ë„ì‹œì§€ì—­ (ìš©ë„ì§€ì—­)</td><td>ì£¼ê±°Â·ìƒì—…Â·ê³µì—…Â·ë…¹ì§€ ë“± ìš©ë„ì§€ì—­ ìƒ‰ìƒ êµ¬ë¶„</td></tr>
          <tr><td>ì§€êµ¬ë‹¨ìœ„ê³„íšêµ¬ì—­</td><td>ì§€êµ¬ë‹¨ìœ„ê³„íšì´ ìˆ˜ë¦½ëœ êµ¬ì—­ í‘œì‹œ</td></tr>
        </table>
        <div class="hm-row" style="margin-top:10px;">
          <div class="hm-icon">ğŸŒ¿</div>
          <div class="hm-text"><strong>êµ­í† í™˜ê²½ì„±í‰ê°€ ì£¼ì œë„</strong>ëŠ” í† ì§€ì˜ í™˜ê²½ ë³´ì „ ë“±ê¸‰ì„ í‘œì‹œí•©ë‹ˆë‹¤.</div>
        </div>
        <div style="display:flex;gap:6px;flex-wrap:wrap;margin:6px 0 4px 34px;">
          <span class="hm-badge" style="background:#006633;">1ë“±ê¸‰ (ë³´ì „ ìµœìš°ì„ )</span>
          <span class="hm-badge" style="background:#339966;">2ë“±ê¸‰</span>
          <span class="hm-badge" style="background:#BBAA00;">3ë“±ê¸‰</span>
          <span class="hm-badge" style="background:#CC6600;">4ë“±ê¸‰</span>
          <span class="hm-badge" style="background:#CC3300;">5ë“±ê¸‰ (ê°œë°œ ê°€ëŠ¥)</span>
        </div>
        <div class="hm-tip">ğŸ’¡ ì²´í¬ë°•ìŠ¤ë¡œ ê° ë ˆì´ì–´ë¥¼ ì¼œê³  ëŒ ìˆ˜ ìˆìœ¼ë©°, ë“œë˜ê·¸ë¡œ ë ˆì´ì–´ ìˆœì„œë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
      </div>

      <hr class="hm-divider"/>

      <!-- 5. ë°ì´í„° ìˆ˜ì§‘ ë° ë‚´ë³´ë‚´ê¸° -->
      <div class="hm-sec">
        <div class="hm-sec-title">5. ë°ì´í„° ìˆ˜ì§‘ ë° ë‚´ë³´ë‚´ê¸°</div>
        <div class="hm-row">
          <div class="hm-icon">ğŸ“</div>
          <div class="hm-text">ì—¬ëŸ¬ í•„ì§€ë¥¼ í´ë¦­í•´ ìˆ˜ì§‘í•˜ë©´ <strong>í•„ì§€ ìˆ˜ ë° ë©´ì  í•©ê³„</strong>ê°€ ìë™ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤.</div>
        </div>
        <div class="hm-row">
          <div class="hm-icon">ğŸ’°</div>
          <div class="hm-text"><strong>ê³µì‹œì§€ê°€ ì´ì•¡</strong>ì„ ì› / ì²œì› / ë°±ë§Œì› / ì–µì› ë‹¨ìœ„ë¡œ ì „í™˜í•˜ì—¬ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
        </div>
        <div class="hm-row">
          <div class="hm-icon">ğŸ”ƒ</div>
          <div class="hm-text">ëª©ë¡ ì •ë ¬: <strong>ìµœì‹ ìˆœ</strong> Â· <strong>ì§€ë²ˆ ì˜¤ë¦„ì°¨ìˆœ(â–²)</strong> Â· <strong>ì§€ë²ˆ ë‚´ë¦¼ì°¨ìˆœ(â–¼)</strong></div>
        </div>
        <table class="hm-table" style="margin-top:8px;">
          <tr><th>ë²„íŠ¼</th><th>ê¸°ëŠ¥</th></tr>
          <tr><td>ğŸ’¾ í† ì§€ì¡°ì„œ ë‚´ë³´ë‚´ê¸°</td><td>ìˆ˜ì§‘ëœ í•„ì§€ ì •ë³´ë¥¼ <strong>CSV íŒŒì¼</strong>ë¡œ ì €ì¥ (ì—‘ì…€ í˜¸í™˜)</td></tr>
          <tr><td>ğŸ“‹ í† ì§€ëª©ë¡ë³´ê¸°</td><td>ìˆ˜ì§‘ ëª©ë¡ì„ <strong>ë³„ë„ ì°½</strong>ì—ì„œ í‘œ í˜•íƒœë¡œ í™•ì¸</td></tr>
          <tr><td>ğŸ—‘ ì „ì²´ ì‚­ì œ</td><td>ìˆ˜ì§‘ëœ ëª¨ë“  í•„ì§€ ì •ë³´ ë° í•˜ì´ë¼ì´íŠ¸ ì´ˆê¸°í™”</td></tr>
        </table>
      </div>

      <hr class="hm-divider"/>

      <!-- 6. ëª¨ë°”ì¼ ì‚¬ìš©ë²• -->
      <div class="hm-sec">
        <div class="hm-sec-title">6. ëª¨ë°”ì¼ ì‚¬ìš©ë²•</div>
        <div class="hm-row">
          <div class="hm-icon">ğŸ“±</div>
          <div class="hm-text">ëª¨ë°”ì¼ì—ì„œëŠ” í™”ë©´ ìƒë‹¨ <strong>55%ê°€ ì§€ë„</strong>, í•˜ë‹¨ <strong>45%ê°€ ì •ë³´ íŒ¨ë„</strong>ë¡œ ë¶„ë¦¬ë©ë‹ˆë‹¤.</div>
        </div>
        <div class="hm-row">
          <div class="hm-icon">â˜°</div>
          <div class="hm-text">í•˜ë‹¨ íŒ¨ë„ ìƒë‹¨ì˜ <strong>í•¸ë“¤ ë°”ë¥¼ íƒ­</strong>í•˜ë©´ íŒ¨ë„ì„ ì ‘ê±°ë‚˜ í¼ì¹  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
        </div>
        <div class="hm-row">
          <div class="hm-icon">â†”</div>
          <div class="hm-text">ëª¨ë°”ì¼ì—ì„œëŠ” ìˆ˜ì§‘ëœ í† ì§€ ëª©ë¡ì´ <strong>ê°€ë¡œ ìŠ¤í¬ë¡¤ í…Œì´ë¸”</strong> í˜•íƒœë¡œ í‘œì‹œë©ë‹ˆë‹¤.</div>
        </div>
        <div class="hm-tip">ğŸ’¡ ëª¨ë°”ì¼ì—ì„œ ì§€ë„ë¥¼ ì¡°ì‘í•  ë•Œ íŒ¨ë„ì´ ë°©í•´ëœë‹¤ë©´ í•¸ë“¤ì„ íƒ­í•˜ì—¬ íŒ¨ë„ì„ ì ‘ì–´ë‘ì„¸ìš”.</div>
      </div>

      <hr class="hm-divider"/>

      <!-- 7. ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ -->
      <div class="hm-sec">
        <div class="hm-sec-title">7. ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ (FAQ)</div>
        <div class="hm-row">
          <div class="hm-icon">â“</div>
          <div class="hm-text"><strong>ì§€ë„ë¥¼ í´ë¦­í•´ë„ ì •ë³´ê°€ ì•ˆ ë‚˜ì™€ìš”.</strong><br>ì§€ë„ë¥¼ ì¶©ë¶„íˆ í™•ëŒ€í•˜ì—¬ ì§€ì ì„ ì´ ë³´ì´ëŠ” ìƒíƒœì—ì„œ í•„ì§€ ìœ„ë¥¼ ì •í™•íˆ í´ë¦­í•´ ì£¼ì„¸ìš”.</div>
        </div>
        <div class="hm-row">
          <div class="hm-icon">â“</div>
          <div class="hm-text"><strong>ê°™ì€ í•„ì§€ë¥¼ ë‘ ë²ˆ í´ë¦­í•˜ë©´?</strong><br>"ì´ë¯¸ ì¶”ê°€ëœ í•„ì§€ì…ë‹ˆë‹¤" ë©”ì‹œì§€ê°€ í‘œì‹œë˜ë©° ì¤‘ë³µ ì¶”ê°€ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
        </div>
        <div class="hm-row">
          <div class="hm-icon">â“</div>
          <div class="hm-text"><strong>ì£¼ì†Œ ê²€ìƒ‰ì´ ì•ˆ ë  ë•ŒëŠ”?</strong><br>ë„ë¡œëª… ì£¼ì†Œ ë˜ëŠ” ì§€ë²ˆ ì£¼ì†Œë¡œ ê²€ìƒ‰í•´ ë³´ì„¸ìš”. ë„ˆë¬´ ê´‘ë²”ìœ„í•œ ê²€ìƒ‰ì–´ë³´ë‹¤ êµ¬ì²´ì ì¸ ì£¼ì†Œê°€ ì •í™•í•©ë‹ˆë‹¤.</div>
        </div>
        <div class="hm-row">
          <div class="hm-icon">â“</div>
          <div class="hm-text"><strong>ì£¼ì œë„ ë ˆì´ì–´ê°€ ë³´ì´ì§€ ì•Šì•„ìš”.</strong><br>ì²´í¬ë°•ìŠ¤ë¥¼ ì²´í¬í•œ ë’¤ ì§€ë„ë¥¼ ì ì ˆíˆ í™•ëŒ€í•˜ë©´ ë ˆì´ì–´ê°€ í‘œì‹œë©ë‹ˆë‹¤. ì¼ë¶€ ë ˆì´ì–´ëŠ” íŠ¹ì • ì¤Œ ë ˆë²¨ ì´ìƒì—ì„œë§Œ ë³´ì…ë‹ˆë‹¤.</div>
        </div>
      </div>

    </div><!-- /.help-modal-body -->
  </div><!-- /.help-modal-box -->
</div><!-- /#helpModal -->

<script>
/* ===================================================
   ì „ì—­ ë³€ìˆ˜
=================================================== */
var apiKey = "A12CEDAE-86F1-3453-BC92-3FD98BE14103";
var ecvamApiKey = "MUTW-PGHX-76CT-ENMD";
var ECVAM_WMS = "https://ecvam.neins.go.kr/apicall.do";
var map2d, map3d, markerLayer;
var currentMapType = "2d";
var isLandParcelActive = false;
var landLayer2d = null, landLayer3d = null;
var map3dClickAdded = false;
var collectedLandInfo = [];
var markers = [];
var themeLayers = {};
var ecvamThemeLayers = {};
var cache = {};
var highlightLayer = null;
var highlight3dEntities = {};
var selectedFeatures = {};
var jigaUnit = 'ì›'; // ê³µì‹œì§€ê°€ í‘œì‹œ ë‹¨ìœ„: 'ì›' | 'ì²œì›' | 'ë°±ë§Œì›' | 'ì–µì›'
var hoverTimer = null;
var hoverCache = {};
var sortMode = 'newest'; // 'newest' | 'jibun_asc' | 'jibun_desc'
var CADASTRAL_MIN_ZOOM = 17; // ì§€ì ë„ ê°€ì‹œ ìµœì†Œ ì¤Œ ë ˆë²¨ (VWorld LP_PA_CBND_BUBUN ê¸°ì¤€)

/* HTML íŠ¹ìˆ˜ë¬¸ì ì´ìŠ¤ì¼€ì´í”„ (XSS ë°©ì§€) */
function escHtml(s) {
  if (s === null || s === undefined) return '';
  return String(s)
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#39;');
}
/* onclick ì†ì„± ë‚´ ë¬¸ìì—´ ì´ìŠ¤ì¼€ì´í”„ */
function escAttr(s) {
  if (s === null || s === undefined) return '';
  return String(s).replace(/[^a-zA-Z0-9\-_]/g, '');
}

/* ì£¼ì†Œ ê²€ìƒ‰ ê²°ê³¼ í•­ëª©ì—ì„œ ë ˆì´ë¸”(ë¬¸ìì—´) ì¶”ì¶œ â€” [object Object] ë°©ì§€ */
function extractLabel(item, fallback) {
  var a = item.address;
  var addrStr = (typeof a === 'object' && a !== null)
    ? (a.road || a.parcel || '')
    : (a || '');
  return item.title || addrStr || fallback || '';
}

/* ì§€ë²ˆ ìì—° ì •ë ¬ ë¹„êµ (ì‚° ì ‘ë‘ì‚¬ ì²˜ë¦¬, ë³¸ë²ˆ-ë¶€ë²ˆ ìˆ«ì ë¹„êµ) */
function naturalCmp(a, b) {
  var aSan = /^ì‚°/.test(String(a)) ? 1 : 0, bSan = /^ì‚°/.test(String(b)) ? 1 : 0;
  if (aSan !== bSan) return aSan - bSan;
  var ap = String(a).replace(/^ì‚°\s*/, '').split('-');
  var bp = String(b).replace(/^ì‚°\s*/, '').split('-');
  var am = parseInt(ap[0]) || 0, bm = parseInt(bp[0]) || 0;
  if (am !== bm) return am - bm;
  return (parseInt(ap[1]) || 0) - (parseInt(bp[1]) || 0);
}

/* ì •ë ¬ ëª¨ë“œ ë³€ê²½ */
function setSortMode(mode) {
  sortMode = mode;
  $('.sort-btn').removeClass('active');
  var ids = { newest: 'sortNewest', jibun_asc: 'sortJibunAsc', jibun_desc: 'sortJibunDesc' };
  $('#' + ids[mode]).addClass('active');
  sortLandList();
}

/* ì¹´ë“œ ëª©ë¡ + ëª¨ë°”ì¼ í…Œì´ë¸” ì¬ì •ë ¬ */
function sortLandList() {
  if (collectedLandInfo.length === 0) return;
  var sorted = collectedLandInfo.slice();
  if (sortMode === 'jibun_asc') {
    sorted.sort(function(a, b) { return naturalCmp(a.jibun || '', b.jibun || ''); });
  } else if (sortMode === 'jibun_desc') {
    sorted.sort(function(a, b) { return naturalCmp(b.jibun || '', a.jibun || ''); });
  } else {
    sorted.reverse(); // ìµœì‹ ìˆœ = ë§ˆì§€ë§‰ ì¶”ê°€ê°€ ë§¨ ìœ„
  }
  // ë°ìŠ¤í¬íƒ‘ ì¹´ë“œ ì¬ë°°ì¹˜
  sorted.forEach(function(d) {
    var $card = $('.land-item[data-pnu="' + d.pnu + '"]');
    if ($card.length) $('#landList').append($card);
  });
  // ëª¨ë°”ì¼ í…Œì´ë¸” í–‰ ì¬ë°°ì¹˜ + ë²ˆí˜¸ ê°±ì‹ 
  sorted.forEach(function(d, i) {
    var $row = $('#mobLandTbody tr[data-pnu="' + d.pnu + '"]');
    if ($row.length) { $row.find('td:first').text(i + 1); $('#mobLandTbody').append($row); }
  });
}

/* ê³µì‹œì§€ê°€ ê¸ˆì•¡ì„ í˜„ì¬ ë‹¨ìœ„ë¡œ í¬ë§· (ì†Œìˆ˜ì  2ìë¦¬) */
function formatJiga(rawAmount) {
  if (!rawAmount || rawAmount <= 0) return '-';
  if (jigaUnit === 'ì–µì›')  return (rawAmount / 100000000).toFixed(2) + ' ì–µì›';
  if (jigaUnit === 'ë°±ë§Œì›') return (rawAmount / 1000000).toFixed(2) + ' ë°±ë§Œì›';
  if (jigaUnit === 'ì²œì›')  return (rawAmount / 1000).toFixed(2) + ' ì²œì›';
  return Math.round(rawAmount).toLocaleString('ko-KR') + ' ì›';
}

/* ë‹¨ìœ„ ë³€ê²½ ì‹œ í™”ë©´ ì „ì²´ ê°±ì‹  */
function changeJigaUnit(unit) {
  jigaUnit = unit;
  // ìš”ì•½ ë°” ì´ì•¡ ê°±ì‹ 
  var totalJiga = 0;
  collectedLandInfo.forEach(function(d) {
    var a = parseFloat(d.area_ || d.parea || 0);
    var j = parseFloat(String(d.jiga || '0').replace(/,/g, ''));
    if (!isNaN(a) && !isNaN(j) && j > 0) totalJiga += (a * j);
  });
  if (totalJiga > 0) $("#jigaSumVal").text(formatJiga(Math.round(totalJiga)));
  // ê° ì¹´ë“œ í† ì§€ ê³µì‹œì§€ê°€ ì´ì•¡ ê°±ì‹ 
  $('.jiga-total-val').each(function() {
    var raw = parseFloat($(this).data('jiga-raw'));
    $(this).text(raw > 0 ? formatJiga(raw) : '-');
  });
}

var themeData = [
  { name:"ì—°ì†ì§€ì ë„",        layer:"LP_PA_CBND_BUBUN",    lf:"jibun" },
  { name:"ë„ì‹œì§€ì—­(ìš©ë„ì§€ì—­)", layer:"LT_C_UQ111",          lf:"uname" },
  { name:"ê´€ë¦¬ì§€ì—­(ìš©ë„ì§€ì—­)", layer:"LT_C_UQ112",          lf:"uname" },
  { name:"ë†ë¦¼ì§€ì—­(ìš©ë„ì§€ì—­)", layer:"LT_C_UQ113",          lf:"uname" },
  { name:"ìì—°í™˜ê²½ë³´ì „ì§€ì—­",   layer:"LT_C_UQ114",          lf:"uname" },
  { name:"ê°œë°œì œí•œêµ¬ì—­",       layer:"LT_C_UD801",          lf:"" },
  { name:"ì§€êµ¬ë‹¨ìœ„ê³„íšêµ¬ì—­",   layer:"LT_C_UPISUQ161",      lf:"dgm_nm" }
];

/* ECVAM í™˜ê²½ì„±í‰ê°€ ë ˆì´ì–´ ëª©ë¡ */
var ecvamThemeData = [
  { id:"nem_ecvam",    name:"êµ­í† í™˜ê²½ì„±í‰ê°€ì§€ë„ (ì¢…í•©ë“±ê¸‰)" },
  { id:"nem_eco_01",   name:"ìƒíƒœìì—°ë„(ë‹¤ì–‘ì„±)" }
];

/* ===================================================
   ì´ˆê¸°í™”
=================================================== */
$(document).ready(function() {
  init2dMap();
  init3dMap();
  setupEvents();
  initThemeList();
  initEcvamThemeList();

  $("#vmap").hide();
  $("#ol3map").show();

  activateLandParcel();

  function activateLandParcel() {
    $("#landChk").prop("checked", true);
    toggleLandParcel(true);
    try { map2d.updateSize(); } catch(e){}
  }

  $(window).on('resize', function(){
    if (currentMapType === "2d") try{ map2d.updateSize(); }catch(e){}
  });
});

/* ===================================================
   2D ì§€ë„ ì´ˆê¸°í™”
=================================================== */
function init2dMap() {
  vw.ol3.MapOptions = {
    basemapType: vw.ol3.BasemapType.GRAPHIC,
    controlDensity: vw.ol3.DensityType.EMPTY,
    interactionDensity: vw.ol3.DensityType.BASIC,
    controlsAutoArrange: true
  };
  map2d = new vw.ol3.Map("ol3map", vw.ol3.MapOptions);
  map2d.getView().setCenter(ol.proj.fromLonLat([127.23601, 37.38138]));
  map2d.getView().setZoom(18);

  highlightLayer = new ol.layer.Vector({
    source: new ol.source.Vector(),
    style: new ol.style.Style({
      stroke: new ol.style.Stroke({ color:'#ff2222', width:3 }),
      fill: new ol.style.Fill({ color:'rgba(255,30,30,0.12)' })
    }),
    zIndex: 500
  });
  map2d.addLayer(highlightLayer);
  markerLayer = new vw.ol3.layer.Marker(map2d, { showTitle:true });
  map2d.addLayer(markerLayer);
  map2d.on('singleclick', debounce(handleMap2dClick, 250));
  map2d.on('moveend', checkCadastralZoom);
}

function checkCadastralZoom() {
  if (currentMapType !== '2d' || !isLandParcelActive) { $('#zoomWarn').hide(); return; }
  try {
    var z = map2d.getView().getZoom();
    if (z < CADASTRAL_MIN_ZOOM) $('#zoomWarn').show();
    else $('#zoomWarn').hide();
  } catch(e) {}
}

/* ===================================================
   3D ì§€ë„ ì´ˆê¸°í™”
=================================================== */
function init3dMap() {
  map3d = new vw.Map();
  map3d.setOption({
    mapId: "vmap",
    initPosition: new vw.CameraPosition(new vw.CoordZ(127.23601, 37.38138, 500), new vw.Direction(0, -90, 0)),
    logo: false, navigation: false
  });
  map3d.start();
}

/* ===================================================
   ì§€ë„ íƒ€ì… ì „í™˜
=================================================== */
function changeMapType() {
  currentMapType = $("#mapTypeSel").val();
  if (currentMapType === "3d") {
    $("#ol3map").hide(); $("#vmap").show();
    $("#currentMapType").text("3D ì§€ë„");
    isLandParcelActive = false; toggleLandParcel(true);
  } else {
    $("#vmap").hide(); $("#ol3map").show();
    $("#currentMapType").text("2D ì¼ë°˜ì§€ë„");
    isLandParcelActive = false; toggleLandParcel(true);
    if (map2d) map2d.updateSize();
  }
}

function toggleLandParcel(enable) {
  if (currentMapType === "3d") {
    if (enable && !isLandParcelActive) {
      var wmsSource = new vw.source.TileWMS();
      wmsSource.setUrl("https://api.vworld.kr/req/wms?Key=" + apiKey + "&");
      wmsSource.setLayers("lt_c_landinfobasemap");
      landLayer3d = new vw.Layers();
      landLayer3d.add(new vw.layer.Tile(wmsSource));
      map3d.onClick.addEventListener(handleMap3dClick);
      isLandParcelActive = true;
    } else if (!enable && isLandParcelActive) {
      if (landLayer3d) landLayer3d.removeAll();
      map3d.onClick.removeEventListener(handleMap3dClick);
      isLandParcelActive = false;
    }
  } else {
    if (enable && !isLandParcelActive) {
      landLayer2d = map2d.addNamedLayer('LP_PA_CBND_BUBUN', 'LP_PA_CBND_BUBUN');
      isLandParcelActive = true;
    } else if (!enable && isLandParcelActive) {
      if (landLayer2d) { map2d.removeLayer(landLayer2d); landLayer2d = null; }
      isLandParcelActive = false;
    }
  }
}

/* ===================================================
   í´ë¦­ í•¸ë“¤ëŸ¬ ë° ë°ì´í„° ì¡°íšŒ (WFS)
=================================================== */
function handleMap2dClick(evt) {
  if (!isLandParcelActive) return;
  var ll = ol.proj.transform(evt.coordinate, 'EPSG:3857', 'EPSG:4326');
  fetchLandInfo(ll[0], ll[1]);
}

function handleMap3dClick(wp, ep, carto) {
  if (carto && isLandParcelActive) fetchLandInfo(carto.longitudeDD, carto.latitudeDD);
}

function fetchLandInfo(lon, lat) {
  showMsg("ğŸ” í† ì§€ ì •ë³´ ì¡°íšŒ ì¤‘...");
  var buf = 0.00015;
  var bbox = (lon-buf)+","+(lat-buf)+","+(lon+buf)+","+(lat+buf);
  
  $.ajax({
    type: "get",
    url: "https://api.vworld.kr/req/wfs",
    data: {
      key: apiKey, SERVICE: "WFS", version: "1.1.0", request: "GetFeature",
      TYPENAME: "lt_c_landinfobasemap,lt_c_uq111,lt_c_upisuq161,lt_c_uq114,lp_pa_cbnd_bubun",
      OUTPUT: "text/javascript", SRSNAME: "EPSG:4326", BBOX: bbox
    },
    dataType: "jsonp",
    jsonpCallback: "parseResponse",
    success: function(data) {
      if (data && data.totalFeatures > 0) processLandData(data, lon, lat);
      else showMsg("ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.", "err");
    }
  });
}

function processLandData(data, lon, lat) {
  var baseFeats = data.features.filter(function(f){ return f.id.includes("lt_c_landinfobasemap"); });
  if (baseFeats.length === 0) baseFeats = data.features.filter(function(f){ return f.properties && f.properties.pnu; });
  if (baseFeats.length === 0) return;

  var best = baseFeats.find(function(f){ return pointInGeom(lon, lat, f.geometry); }) || baseFeats[0];
  var d = Object.assign({}, best.properties);

  if (collectedLandInfo.some(function(x){ return x.pnu === d.pnu; })) {
    showMsg("ì´ë¯¸ ì¶”ê°€ëœ í•„ì§€ì…ë‹ˆë‹¤."); return;
  }

  // ë°ì´í„° ë³´ê°•
  var uqF = data.features.find(function(f){ return f.id.includes("lt_c_uq111") && pointInGeom(lon, lat, f.geometry); });
  d.uname = uqF ? uqF.properties.uname : (d.uname || '-');
  
  var regF = data.features.find(function(f){ return f.id.includes("lt_c_uq114") && pointInGeom(lon, lat, f.geometry); });
  d.reg = regF ? regF.properties.uname : '-';

  var upF = data.features.find(function(f){ return f.id.includes("lt_c_upisuq161") && pointInGeom(lon, lat, f.geometry); });
  d.dgm_nm = upF ? upF.properties.dgm_nm : (d.dgm_nm || '-');

  var jigaF = data.features.find(function(f){ return f.id.includes("lp_pa_cbnd_bubun") && pointInGeom(lon, lat, f.geometry); });
  if (jigaF) d.jiga = jigaF.properties.jiga;

  // í•˜ì´ë¼ì´íŠ¸ í‘œì‹œ
  if (currentMapType === "2d" && best.geometry) {
    addHighlight2d(best.geometry, d.pnu);
  } else if (currentMapType === "3d" && best.geometry) {
    addHighlight3d(best.geometry, d.pnu);
  }

  var parcelCenter = getCenter(best.geometry);
  d._lon = parcelCenter[0]; d._lat = parcelCenter[1]; d._geometry = best.geometry;
  
  addLandInfo(d);
  addMarker(lon, lat, d);
  autoOpenMobileSheet();
  showMsg("âœ… ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.", "ok");
}

function addLandInfo(d) {
  $(".empty-state").remove();
  collectedLandInfo.push(d);
  var addr = [d.emd_nm, d.ri_nm, d.jibun].filter(Boolean).join(' ');
  var rawArea = d.area_ || d.parea || 0;
  var areaDisp = Math.round(rawArea).toLocaleString();

  // PC ì¹´ë“œ
  var $item = $('<div class="land-item" data-pnu="'+d.pnu+'"></div>');
  $item.html('<div class="land-item-hd"><span>'+addr+'</span><button class="del-btn" onclick="removeLand(\''+d.pnu+'\')">ì‚­ì œ</button></div>' +
    '<div class="land-kv">' +
      '<div class="land-kv-sec">ğŸ“ ê¸°ë³¸ì •ë³´</div>' +
      '<div class="land-kv-row"><span class="land-kv-k">ì§€ëª©/ë©´ì </span><span class="land-kv-v">'+d.jimok+' / '+areaDisp+'ã¡</span></div>' +
      '<div class="land-kv-row"><span class="land-kv-k">ê³µì‹œì§€ê°€</span><span class="land-kv-v">'+(d.jiga ? Number(d.jiga).toLocaleString() : '-')+' ì›/ã¡</span></div>' +
      '<div class="land-kv-sec">ğŸ— ìš©ë„ ë° ê·œì œ</div>' +
      '<div class="land-kv-row"><span class="land-kv-k">ìš©ë„ì§€ì—­</span><span class="land-kv-v">'+d.uname+'</span></div>' +
      '<div class="land-kv-row"><span class="land-kv-k">ê¸°íƒ€ê·œì œ</span><span class="land-kv-v" style="color:#d35400;font-weight:800;">'+(d.reg||'-')+'</span></div>' +
    '</div>');
  $("#landList").append($item);

  // ëª¨ë°”ì¼ í…Œì´ë¸”
  var $tr = $('<tr data-pnu="'+d.pnu+'"><td>'+collectedLandInfo.length+'</td><td>'+addr+'</td><td>'+d.jimok+'</td><td>'+areaDisp+'</td><td>'+d.uname+'</td><td>'+(d.reg||'-')+'</td><td>'+(d.dgm_nm||'-')+'</td><td><button class="mob-del-btn" onclick="removeLand(\''+d.pnu+'\')">ì‚­</button></td></tr>');
  $('#mobLandTbody').append($tr);
  $('#mobLandTableWrap').addClass('active');
  updateCnt();
}

window.removeLand = function(pnu) {
  if (selectedFeatures[pnu]) highlightLayer.getSource().removeFeature(selectedFeatures[pnu]);
  removeHighlight3d(pnu);
  collectedLandInfo = collectedLandInfo.filter(function(x){ return x.pnu !== pnu; });
  $('.land-item[data-pnu="'+pnu+'"]').remove();
  $('tr[data-pnu="'+pnu+'"]').remove();
  updateCnt();
};

/* ===================================================
   í•˜ì´ë¼ì´íŠ¸ ë° ìœ í‹¸ë¦¬í‹°
=================================================== */
function addHighlight2d(geometry, pnu) {
  var coords = geometry.type === 'MultiPolygon' ? geometry.coordinates[0][0] : geometry.coordinates[0];
  var poly = new ol.geom.Polygon([coords.map(function(c){ return ol.proj.fromLonLat(c); })]);
  var f = new ol.Feature({ geometry: poly });
  highlightLayer.getSource().addFeature(f);
  selectedFeatures[pnu] = f;
}

function findCesiumViewer() {
  var C = window.Cesium || (typeof vw !== 'undefined' && vw.Cesium);
  if (!C || !map3d) return null;
  return map3d._viewer || map3d.viewer || map3d.getCesiumViewer();
}

function addHighlight3d(geometry, pnu) {
  var C = window.Cesium || (typeof vw !== 'undefined' && vw.Cesium);
  var viewer = findCesiumViewer();
  if (!viewer || !C) return;
  var coords = geometry.type === 'MultiPolygon' ? geometry.coordinates[0][0] : geometry.coordinates[0];
  var positions = coords.map(function(c) { return C.Cartesian3.fromDegrees(c[0], c[1]); });
  var polyEnt = viewer.entities.add({
    polygon: { hierarchy: new C.PolygonHierarchy(positions), material: C.Color.RED.withAlpha(0.3) }
  });
  highlight3dEntities[pnu] = { poly: polyEnt };
}

function removeHighlight3d(pnu) {
  var ents = highlight3dEntities[pnu];
  var viewer = findCesiumViewer();
  if (ents && viewer) { viewer.entities.remove(ents.poly); delete highlight3dEntities[pnu]; }
}

function pointInGeom(px, py, geom) {
  if (!geom) return false;
  var ring = geom.type === 'MultiPolygon' ? geom.coordinates[0][0] : geom.coordinates[0];
  var inside = false;
  for (var i = 0, j = ring.length - 1; i < ring.length; j = i++) {
    var xi = ring[i][0], yi = ring[i][1], xj = ring[j][0], yj = ring[j][1];
    if (((yi > py) !== (yj > py)) && (px < (xj-xi)*(py-yi)/(yj-yi)+xi)) inside = !inside;
  }
  return inside;
}

function geomArea(geom) {
  var ring = geom.type === 'MultiPolygon' ? geom.coordinates[0][0] : geom.coordinates[0];
  var area = 0;
  for (var i = 0, j = ring.length-1; i < ring.length; j = i++) area += (ring[j][0]+ring[i][0]) * (ring[j][1]-ring[i][1]);
  return Math.abs(area)/2;
}

function getCenter(geom) {
  var coords = geom.type==='MultiPolygon' ? geom.coordinates[0][0] : geom.coordinates[0];
  var sx=0, sy=0;
  coords.forEach(function(p){ sx+=p[0]; sy+=p[1]; });
  return [sx/coords.length, sy/coords.length];
}

function getBuf(lon, lat) { return [0.00015, 0.00015]; }

function updateCnt() {
  var cnt = collectedLandInfo.length;
  $("#landCnt").text("ì´ " + cnt + "ê±´");
  var totalArea = collectedLandInfo.reduce(function(s, d){ return s + (parseFloat(d.area_ || d.parea) || 0); }, 0);
  $("#areaSumVal").text(Math.round(totalArea).toLocaleString() + " ã¡");
  if (cnt > 0) { $("#areaSumBar").show(); $(".empty-state").hide(); }
  else { $("#areaSumBar").hide(); showEmptyState(); }
}

function showEmptyState() {
  if (!$('#landList .empty-state').length) $('#landList').append('<div class="empty-state"><div class="ico">ğŸ“</div><p>ì§€ë„ì—ì„œ í† ì§€ë¥¼ í´ë¦­í•˜ë©´<br>ìƒì„¸ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤</p></div>');
}

function showMsg(msg, type) {
  $("#statusBar").removeClass("ok err").addClass(type||'').text(msg).show().fadeOut(4000);
}

function debounce(fn, wait) {
  var t; return function() { clearTimeout(t); var ctx=this, args=arguments; t=setTimeout(function(){ fn.apply(ctx,args); }, wait); };
}

function moveTo(lon, lat) {
  if (currentMapType === "2d") map2d.getView().animate({ center: ol.proj.fromLonLat([lon, lat]), duration: 400 });
}

/* ë‚˜ë¨¸ì§€ UI ì´ë²¤íŠ¸ */
window.searchAddress = function() {
  var q = $("#addrInput").val().trim();
  if (!q) return;
  $.ajax({
    type: "get", url: "https://api.vworld.kr/req/search",
    data: { service:"search", version:"2.0", request:"search", key:apiKey, query:q, type:"address", category:"road", crs:"EPSG:4326", format:"json" },
    dataType: "jsonp",
    success: function(data) {
      if (data.response.status === "OK" && data.response.result.items.length > 0) {
        var pt = data.response.result.items[0].point;
        moveTo(parseFloat(pt.x), parseFloat(pt.y));
      }
    }
  });
};

window.toggleThemePanel = function() { $("#themeList").slideToggle(); };
window.toggleEcvamPanel = function() { $("#ecvamThemeList").slideToggle(); };
window.toggleMobileSheet = function() { $("#sidePanel").toggleClass("sheet-collapsed"); };
window.clearLandInfo = function() { if(confirm("ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) location.reload(); };
function initThemeList() {}
function initEcvamThemeList() {}
function setupEvents() {
  $("#addrInput").on('keydown', function(e){ if (e.key === 'Enter') searchAddress(); });
}
function fetchEcvamGrade() {}
function updateEcvamGradeOnCard() {}
function autoOpenMobileSheet() {}
function addMarker() {}
function sortLandList() {}
function changeJigaUnit() {}
function openInNewWindow() {}
function openTableWindow() {}
function exportToCSV() {}
function openHelp() { document.getElementById('helpModal').classList.add('open'); }
function closeHelp() { document.getElementById('helpModal').classList.remove('open'); }
function closeHelpOutside(e) { if (e.target.id === 'helpModal') closeHelp(); }
</script>
</body>
</html>
